# MobSF AI Sidecar

This project adds an AI-powered chat assistant to the [Mobile Security Framework (MobSF)](https://github.com/MobSF/Mobile-Security-Framework-MobSF). It allows security analysts to ask questions about the analysis report generated by MobSF directly within the interface, leveraging OpenAI's model.

## Features

-   **Seamless Integration**: Injects a specialized chat interface directly into MobSF reports using an Nginx reverse proxy.
-   **Context-Aware**: The AI assistant automatically retrieves the current analysis report (static analysis) and uses it as context to answer your questions.
-   **Interactive Q&A**: Ask about vulnerabilities, code snippets, remediation steps or general security concepts related to your app.

## Architecture & How It Works

The solution is composed of three Docker services working together:

1.  **MobSF (`mobsf`)**: The standard Mobile Security Framework application running on port 8000.
2.  **Sidecar (`chat`)**: A Python Flask application that runs on port 5000.
    -   Serves the chat UI.
    -   Integrates the user, the MobSF API and OpenAI API.
    -   Fetches the report JSON from MobSF using the unique scan hash.
    -   Sends the relevant parts of the report along with the user's query to the OpenAI API.
3.  **Gateway (`gateway`)**: An Nginx reverse proxy (listening on port 8080) that coordinates everything:
    -   Proxies standard traffic to the MobSF container.
    -   Routes `/chat/` and `/api/chat` requests to the Sidecar container.

### Data Flow
1.  User uploads the Mobile App in MobSF.
2.  User opens the view report in MobSF when mobile app analysis completed.
3.  User clicks the Chat button.
4.  Browser opens a separate chat window.
5.  User can integract with this particular app report data.
6.  Sidecar fetches the report from MobSF API then sends prompt + report + question to OpenAI and returns answer.

## Prerequisites

-   [Docker](https://docs.docker.com/get-docker/) and [Docker Compose](https://docs.docker.com/compose/install/)
-   An [OpenAI API Key](https://platform.openai.com/api-keys)

## Setup & Run

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd Mobsf_Side_Car
    ```

2.  **Configure Environment:**
    Open `docker-compose-mobsfai.yml` and check the environment variables.
    
    You generally need to provide your OpenAI API Key. You can set it directly in the file (not recommended for committed code) or export it in your shell:
    ```bash
    export MOBSF_OPENAI_API_KEY="sk-..."
    ```
    
    *Note: The `MOBSF_API_KEY` is currently hardcoded to `1234567890` in the docker-compose file for both the MobSF instance and the Sidecar to communicate. If you change it in one place, ensure you update it in both services. You can the API in MobSF GUI as well.*

3.  **Build and Start:**
    Run the following command to build the chat container and start the stack:
    ```bash
    docker-compose -f docker-compose-mobsfai.yml up --build
    ```

4.  **Access the Application:**
    Open your browser and navigate to:
    **http://localhost:8080**
    
    *(Note: Do not use port 8000, as that bypasses the Nginx gateway and the chat button will not appear.)*

## Usage

1.  Go to **http://localhost:8080**.
2.  Upload an Android (APK) or iOS (IPA) application for analysis.
3.  Wait for the scan to complete.
4.  Once the "Static Analysis" report loads, look for a **floating Chat button (ðŸ’¬)** in the bottom-right corner.
5.  Click the button to open the AI assistant.
6.  Ask questions like:
    -   "Summarize the critical vulnerabilities."
    -   "How do I fix the high-severity issues found in the manifest?"
    -   "Explain the 'Application is debuggable' finding."

## Troubleshooting

-   **Chat button not appearing?**
    -   Ensure you are accessing via `http://localhost:8080` and not port 8000.
    -   Check the browser console for any JavaScript errors.
    -   Ensure the URL contains `/StaticAnalyzer/` or matches the pattern expected by the injected script.
-   **AI Error / OpenAI Issues?**
    -   Check the logs of the chat container: `docker logs mobsf_chat`.
    -   Verify your `OPENAI_API_KEY` is valid and has access to the `gpt-4o` model.
-   **MobSF Communication Errors?**
    -   Ensure the `MOBSF_API_KEY` matches in both the `mobsf` and `chat` service definitions in `docker-compose-mobsfai.yml`.

## AshishSecDev